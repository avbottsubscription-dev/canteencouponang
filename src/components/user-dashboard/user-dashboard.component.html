<div class="container mx-auto">
  @if (currentEmployee(); as employee) {
    <h1 class="text-3xl font-bold text-gray-800 dark:text-white mb-2">
      Welcome, {{ employee.name }}
    </h1>
    <p class="text-md text-gray-500 dark:text-gray-400 mb-6">
      {{ employee.department }} Department
    </p>
  }

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <div class="lg:col-span-2">
      <!-- Coupon Stats -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md">
          <h3 class="text-lg font-semibold text-gray-500 dark:text-gray-400">
            Total Coupons
          </h3>
          <p class="text-4xl font-bold text-indigo-600 dark:text-indigo-400">
            {{ totalCoupons() }}
          </p>
        </div>
        <div class="p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md">
          <h3 class="text-lg font-semibold text-gray-500 dark:text-gray-400">
            Remaining Coupons
          </h3>
          <p class="text-4xl font-bold text-green-600 dark:text-green-400">
            {{ remainingCoupons() }}
          </p>
        </div>
        <div
          class="p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md flex flex-col justify-between"
        >
          <div>
            <h3 class="text-lg font-semibold text-gray-500 dark:text-gray-400">
              Used Coupons
            </h3>
            <p class="text-4xl font-bold text-red-600 dark:text-red-400">
              {{ usedCoupons() }}
            </p>
          </div>
          @if (usedCoupons() > 0) {
            <div class="mt-2 text-right">
              <a
                (click)="openHistoryModal()"
                class="text-sm font-medium text-indigo-600 hover:underline dark:text-indigo-400 cursor-pointer"
                >View History</a
              >
            </div>
          }
        </div>
      </div>

      <!-- Next Available Coupons -->
      <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">
        Your Next Available Coupons
      </h2>
      @if (nextAvailableCoupons().length > 0) {
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          @for (coupon of nextAvailableCoupons(); track coupon.couponId) {
            <div
              class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 flex flex-col justify-between animate-fadeIn"
            >
              <div>
                <div class="flex justify-between items-center mb-4">
                  <h3
                    class="text-xl font-bold text-gray-800 dark:text-white"
                  >
                    {{ coupon.couponType }} Coupon
                  </h3>
                  <span
                    class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300"
                    >Available</span
                  >
                </div>
                <p
                  class="text-sm text-gray-500 dark:text-gray-400"
                >
                  Issued on: {{ formatDateTime(coupon.dateIssued) }}
                </p>
              </div>
              <div class="mt-6 text-center">
                <p
                  class="text-sm text-gray-500 dark:text-gray-400 mb-2"
                >
                  Your redemption code is:
                </p>
                <p
                  class="text-4xl font-mono font-bold tracking-widest text-indigo-600 dark:text-indigo-400"
                >
                  {{ coupon.redemptionCode }}
                </p>
              </div>
              <div class="mt-6">
                <button
                  (click)="openRedeemModal(coupon)"
                  class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors"
                >
                  Redeem
                </button>
              </div>
            </div>
          }
        </div>
      } @else {
        <div
          class="bg-white dark:bg-gray-800 rounded-lg shadow-md text-center py-16 px-6"
        >
          <svg
            class="mx-auto h-12 w-12 text-gray-400"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9.548 4.131l-3.332 3.332a4.5 4.5 0 000 6.364l3.332 3.332a4.5 4.5 0 006.364 0l3.332-3.332a4.5 4.5 0 000-6.364l-3.332-3.332a4.5 4.5 0 00-6.364 0z"
            />
          </svg>
          <h3
            class="mt-4 text-lg font-semibold text-gray-900 dark:text-white"
          >
            All Coupons Redeemed!
          </h3>
          <p class="mt-2 text-gray-500 dark:text-gray-400">
            You have no more available coupons to redeem. New coupons will
            be issued according to the schedule.
          </p>
        </div>
      }
    </div>

    <!-- Today's Menu -->
    <div class="lg:col-span-1">
      <div
        class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 h-full"
      >
        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">
          Today's Menu
        </h2>
        @if (todaysMenu(); as menu) {
          <div class="space-y-6">
            <!-- Breakfast Section -->
            <div>
              <h3
                class="text-lg font-semibold text-yellow-700 dark:text-yellow-400 mb-2"
              >
                Breakfast
              </h3>
              <p
                class="text-gray-600 dark:text-gray-300 whitespace-pre-line"
              >
                {{ menu.breakfastMenu }}
              </p>
            </div>
            <!-- Lunch/Dinner Section -->
            <div
              class="border-t border-gray-200 dark:border-gray-700 pt-6"
            >
              <h3
                class="text-lg font-semibold text-blue-700 dark:text-blue-400 mb-2"
              >
                Lunch / Dinner
              </h3>
              <p
                class="text-gray-600 dark:text-gray-300 whitespace-pre-line"
              >
                {{ menu.lunchDinnerMenu }}
              </p>
            </div>
          </div>
        } @else {
          <div
            class="text-center py-10 flex flex-col items-center justify-center h-full"
          >
            <svg
              class="mx-auto h-12 w-12 text-gray-400"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"
              />
            </svg>
            <h3
              class="mt-4 text-lg font-semibold text-gray-900 dark:text-white"
            >
              Menu Not Available
            </h3>
            <p
              class="mt-2 text-sm text-gray-500 dark:text-gray-400"
            >
              The menu for today has not been published yet. Please check
              back later.
            </p>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Generate Guest Pass Section (card) -->
  <div class="mt-8 bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
    <div class="flex flex-col md:flex-row items-center gap-6">
      <div class="flex-shrink-0">
        <div
          class="w-16 h-16 rounded-full bg-teal-100 dark:bg-teal-900 flex items-center justify-center"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-8 w-8 text-teal-600 dark:text-teal-400"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"
            />
          </svg>
        </div>
      </div>
      <div class="flex-1 text-center md:text-left">
        <h2 class="text-xl font-bold text-gray-800 dark:text-white">
          Need a Guest Pass?
        </h2>
        <p class="text-gray-600 dark:text-gray-400 mt-2">
          Send a guest pass request for visitors. Admin will review and
          approve. Approved guest passes can be shared via QR or WhatsApp.
        </p>

        @let stats = guestCouponStats();
        @if (stats.generated > 0) {
          <div
            class="mt-4 flex justify-center md:justify-start items-center space-x-6"
          >
            <div class="text-center">
              <p
                class="text-2xl font-bold text-gray-700 dark:text-gray-300"
              >
                {{ stats.generated }}
              </p>
              <p
                class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                Generated
              </p>
            </div>
            <div class="text-center">
              <p
                class="text-2xl font-bold text-gray-700 dark:text-gray-300"
              >
                {{ stats.redeemed }}
              </p>
              <p
                class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"
              >
                Redeemed
              </p>
            </div>
          </div>
          <div class="mt-2 text-center md:text-left">
            <a
              (click)="openGuestHistoryModal()"
              class="text-sm font-medium text-teal-600 hover:underline dark:text-teal-400 cursor-pointer"
              >View Generated Pass History</a
            >
          </div>
        }
      </div>
      <div class="flex-shrink-0">
        <button
          (click)="openGenerateGuestPassModal()"
          class="bg-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-teal-700 transition-colors"
        >
          Request Guest Pass
        </button>
      </div>
    </div>
  </div>

  <!-- Redeem Coupon Modal -->
  @if (isRedeemModalOpen() && selectedCouponForRedemption(); as coupon) {
    <div
      class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50"
    >
      <div
        class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-sm text-center"
      >
        <h3 class="text-xl font-bold mb-2 text-gray-800 dark:text-white">
          Redeem Your Coupon
        </h3>
        <p class="text-gray-600 dark:text-gray-400 mb-6">
          Show this QR code to the canteen staff.
        </p>

        <div class="p-2 bg-white inline-block rounded-lg">
          @if (qrCodeDataUrl()) {
            <img
              [src]="qrCodeDataUrl()"
              alt="Redemption QR Code"
              class="w-56 h-56 mx-auto"
            />
          } @else {
            <div
              class="w-56 h-56 bg-gray-200 dark:bg-gray-700 flex items-center justify-center rounded-md"
            >
              <p class="text-sm text-gray-500 dark:text-gray-400">
                Generating QR Code...
              </p>
            </div>
          }
        </div>

        <p
          class="text-sm text-gray-500 dark:text-gray-400 mt-4 mb-4"
        >
          Or use the code below:
        </p>

        <div
          class="bg-gray-100 dark:bg-gray-700 rounded-lg p-3 mb-6"
        >
          <p
            class="text-4xl font-mono font-bold tracking-widest text-indigo-600 dark:text-indigo-400"
          >
            {{ coupon.redemptionCode }}
          </p>
        </div>

        <p
          class="text-xs text-gray-500 dark:text-gray-500 mb-6"
        >
          Coupon ID: {{ coupon.couponId }} ({{ coupon.couponType }})
        </p>

        <div class="mt-8">
          <button
            type="button"
            (click)="closeRedeemModal()"
            class="w-full px-6 py-3 rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 font-semibold"
          >
            Done
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Generate Guest Pass (Request) Modal -->
  @if (isGenerateGuestPassModalOpen()) {
    <div
      class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50"
    >
      <div
        class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-md text-left"
      >
        <h3 class="text-xl font-bold mb-2 text-gray-800 dark:text-white">
          Request Guest Pass
        </h3>
        <p class="text-gray-600 dark:text-gray-400 mb-6">
          Enter your guest details and submit a request. Admin will review
          and approve.
        </p>

        @if (requestError()) {
          <div
            class="mb-4 p-3 rounded-md bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-700 text-sm text-red-700 dark:text-red-200"
          >
            {{ requestError() }}
          </div>
        }
        @if (requestSuccess()) {
          <div
            class="mb-4 p-3 rounded-md bg-green-50 dark:bg-green-900/50 border border-green-200 dark:border-green-700 text-sm text-green-700 dark:text-green-200"
          >
            {{ requestSuccess() }}
          </div>
        }

        <div class="space-y-4">
          <div>
            <label
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
            >
              Guest Full Name
            </label>
            <input
              type="text"
              class="w-full p-2.5 border rounded-lg dark:bg-gray-700 dark:border-gray-600"
              [value]="guestName()"
              (input)="guestName.set($any($event.target).value)"
              placeholder="Enter guest name"
            />
          </div>

          <div>
            <label
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
            >
              Guest Company
            </label>
            <input
              type="text"
              class="w-full p-2.5 border rounded-lg dark:bg-gray-700 dark:border-gray-600"
              [value]="guestCompany()"
              (input)="guestCompany.set($any($event.target).value)"
              placeholder="Enter company name"
            />
          </div>

          <div>
            <label
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
            >
              Coupon Type
            </label>
            <select
              class="w-full p-2.5 border rounded-lg dark:bg-gray-700 dark:border-gray-600"
              [value]="selectedGuestCouponType() || ''"
              (change)="selectedGuestCouponType.set($any($event.target).value)"
            >
              <option value="" disabled>Select coupon type</option>
              @for (type of guestPassTypes; track type) {
                <option [value]="type">{{ type }}</option>
              }
            </select>
          </div>
        </div>

        <div class="mt-8 flex justify-end space-x-3">
          <button
            type="button"
            (click)="closeGenerateGuestPassModal()"
            class="px-4 py-2 rounded-md text-gray-700 bg-gray-100 hover:bg-gray-200 dark:text-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600"
          >
            Cancel
          </button>
          <button
            type="button"
            (click)="submitGuestPassRequest()"
            [disabled]="requestSubmitting()"
            class="px-4 py-2 rounded-md text-white bg-teal-600 hover:bg-teal-700 disabled:bg-teal-400"
          >
            @if (!requestSubmitting()) { Submit Request } @else { Submitting... }
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Redeemed History Modal -->
  @if (isHistoryModalOpen()) {
    <div
      class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 animate-fadeIn"
    >
      <div
        class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-2xl text-left flex flex-col m-4"
      >
        <div
          class="flex justify-between items-center mb-4 border-b border-gray-200 dark:border-gray-700 pb-4"
        >
          <h3 class="text-xl font-bold text-gray-800 dark:text-white">
            Redeemed Coupon History
          </h3>
          <button
            (click)="closeHistoryModal()"
            class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"
          >
            <span class="sr-only">Close</span>
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>
        <div class="overflow-y-auto max-h-[60vh]">
          <table
            class="min-w-full divide-y divide-gray-200 dark:divide-gray-700"
          >
            <thead
              class="bg-gray-50 dark:bg-gray-700/50 sticky top-0"
            >
              <tr>
                <th
                  scope="col"
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
                >
                  Coupon Type
                </th>
                <th
                  scope="col"
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
                >
                  Redeemed On
                </th>
                <th
                  scope="col"
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
                >
                  Redemption Code
                </th>
                <th
                  scope="col"
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
                >
                  Coupon ID
                </th>
              </tr>
            </thead>
            <tbody
              class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"
            >
              @for (coupon of redeemedCouponsHistory(); track coupon.couponId) {
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span
                      [class]="getCouponTypeClass(coupon.couponType)"
                      class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full capitalize"
                    >
                      {{ coupon.couponType }}
                    </span>
                  </td>
                  <td
                    class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300"
                  >
                    {{ formatDateTime(coupon.redeemDate) }}
                  </td>
                  <td
                    class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-700 dark:text-gray-300 font-bold"
                  >
                    {{ coupon.redemptionCode }}
                  </td>
                  <td
                    class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-500 dark:text-gray-400"
                  >
                    {{ coupon.couponId }}
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
        <div
          class="mt-6 text-right border-t border-gray-200 dark:border-gray-700 pt-4"
        >
          <button
            type="button"
            (click)="closeHistoryModal()"
            class="px-6 py-2 rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 font-semibold"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Generated Guest Pass History Modal -->
  @if (isGuestHistoryModalOpen()) {
    <div
      class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 animate-fadeIn"
    >
      <div
        class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-4xl text-left flex flex-col m-4"
      >
        <div
          class="flex justify-between items-center mb-4 border-b border-gray-200 dark:border-gray-700 pb-4"
        >
          <h3 class="text-xl font-bold text-gray-800 dark:text-white">
            Generated Guest Pass History
          </h3>
          <button
            (click)="closeGuestHistoryModal()"
            class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"
          >
            <span class="sr-only">Close</span>
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>
        <div class="overflow-y-auto max-h-[60vh]">
          <table
            class="min-w-full divide-y divide-gray-200 dark:divide-gray-700"
          >
            <thead
              class="bg-gray-50 dark:bg-gray-700/50 sticky top-0"
            >
              <tr>
                <th
                  scope="col"
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
                >
                  Coupon Type
                </th>
                <th
                  scope="col"
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
                >
                  Status
                </th>
                <th
                  scope="col"
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
                >
                  Redemption Code
                </th>
                <th
                  scope="col"
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
                >
                  Generated On
                </th>
                <th
                  scope="col"
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"
                >
                  Redeemed On
                </th>
                <th
                  scope="col"
                  class="relative px-6 py-3"
                >
                  <span class="sr-only">Actions</span>
                </th>
              </tr>
            </thead>
            <tbody
              class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"
            >
              @for (coupon of generatedGuestCouponsHistory(); track coupon.couponId) {
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span
                      [class]="getCouponTypeClass(coupon.couponType)"
                      class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full capitalize"
                    >
                      {{ coupon.couponType }}
                    </span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span
                      [class]="
                        coupon.status === 'redeemed'
                          ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300'
                          : 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300'
                      "
                      class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full capitalize"
                    >
                      {{ coupon.status }}
                    </span>
                  </td>
                  <td
                    class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-700 dark:text-gray-300 font-bold"
                  >
                    {{ coupon.redemptionCode }}
                  </td>
                  <td
                    class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300"
                  >
                    {{ formatDateTime(coupon.dateIssued) }}
                  </td>
                  <td
                    class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300"
                  >
                    {{ formatDateTime(coupon.redeemDate) }}
                  </td>
                  <td
                    class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"
                  >
                    @if (coupon.status === 'issued') {
                      <button
                        (click)="openGuestQrModal(coupon)"
                        class="text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-200 font-semibold px-2 py-1"
                      >
                        View QR
                      </button>
                    }
                  </td>
                </tr>
              } @empty {
                <tr>
                  <td
                    colspan="6"
                    class="text-center py-8 text-gray-500 dark:text-gray-400"
                  >
                    You have not generated any guest passes yet.
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
        <div
          class="mt-6 text-right border-t border-gray-200 dark:border-gray-700 pt-4"
        >
          <button
            type="button"
            (click)="closeGuestHistoryModal()"
            class="px-6 py-2 rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 font-semibold"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  }

  <!-- View Guest Pass QR Modal -->
  @if (isGuestQrModalOpen() && selectedGuestCouponForQr(); as coupon) {
    <div
      class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50"
    >
      <div
        class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-sm text-center"
      >
        <h3 class="text-xl font-bold mb-2 text-gray-800 dark:text-white">
          Guest Pass Details
        </h3>
        <p class="text-gray-600 dark:text-gray-400 mb-6">
          Share this QR code with your guest.
        </p>

        <div class="p-2 bg-white inline-block rounded-lg">
          @if (guestPassQrCodeDataUrl()) {
            <img
              [src]="guestPassQrCodeDataUrl()"
              alt="Guest Pass QR Code"
              class="w-56 h-56 mx-auto"
            />
          } @else {
            <div
              class="w-56 h-56 bg-gray-200 dark:bg-gray-700 flex items-center justify-center rounded-md"
            >
              <p class="text-sm text-gray-500 dark:text-gray-400">
                Generating QR Code...
              </p>
            </div>
          }
        </div>

        <p
          class="text-sm text-gray-500 dark:text-gray-400 mt-4 mb-4"
        >
          Or use the code below:
        </p>

        <div
          class="bg-gray-100 dark:bg-gray-700 rounded-lg p-3 mb-4"
        >
          <p
            class="text-4xl font-mono font-bold tracking-widest text-teal-600 dark:text-teal-400"
          >
            {{ coupon.redemptionCode }}
          </p>
        </div>

        <p
          class="text-xs text-gray-500 dark:text-gray-500 mb-4"
        >
          This is a single-use {{ coupon.couponType }} guest pass.
        </p>

        <div class="mt-4 grid grid-cols-2 gap-3">
          <!-- Copy code -->
          <button
            type="button"
            (click)="copyCodeToClipboard(coupon.redemptionCode)"
            class="w-full inline-flex justify-center items-center px-4 py-2 border border-gray-300 dark:border-gray-600 shadow-sm text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 transition-all"
          >
            @if (!copySuccess()) {
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 mr-2"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                />
              </svg>
              Copy Code
            } @else {
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 mr-2 text-green-500"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                  clip-rule="evenodd"
                />
              </svg>
              <span class="text-green-600 dark:text-green-400"
                >Copied!</span
              >
            }
          </button>

          <!-- WhatsApp share -->
          <a
            [href]="'https://wa.me/?text=' + whatsAppShareMessage()"
            target="_blank"
            class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 mr-2"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.487 5.235 3.487 8.413 0 6.557-5.338 11.892-11.894 11.892-1.99 0-3.903-.52-5.687-1.475L0 24h.057zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.886-.001 2.267.655 4.398 1.908 6.166l-1.138 4.167 4.274-1.12z"
              />
            </svg>
            Share on WhatsApp
          </a>
        </div>

        <div class="mt-8">
          <button
            type="button"
            (click)="closeGuestQrModal()"
            class="w-full px-6 py-3 rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 font-semibold"
          >
            Done
          </button>
        </div>
      </div>
    </div>
  }
</div>
