<div class="container mx-auto max-w-lg mt-10">
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8">
    <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Change Password</h1>
    <div class="border-b border-gray-200 dark:border-gray-700 my-6"></div>
    
    <form [formGroup]="changePasswordForm" (ngSubmit)="handleChangePassword()" class="space-y-6">
      <div>
        <label for="currentPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Current Password</label>
        <input id="currentPassword" type="password" formControlName="currentPassword" class="w-full p-2 border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600">
        @if (changePasswordForm.get('currentPassword')?.invalid && changePasswordForm.get('currentPassword')?.touched) {
          <p class="text-red-500 text-xs mt-1">Current password is required.</p>
        }
      </div>

      <div>
        <label for="newPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">New Password</label>
        <input id="newPassword" type="password" formControlName="newPassword" class="w-full p-2 border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600">
        @if (changePasswordForm.get('newPassword')?.invalid && changePasswordForm.get('newPassword')?.touched) {
          <p class="text-red-500 text-xs mt-1">New password must be at least 6 characters long.</p>
        }
      </div>

      <div>
        <label for="confirmNewPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Confirm New Password</label>
        <input id="confirmNewPassword" type="password" formControlName="confirmNewPassword" class="w-full p-2 border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600">
        @if (changePasswordForm.get('confirmNewPassword')?.invalid && changePasswordForm.get('confirmNewPassword')?.touched) {
          <p class="text-red-500 text-xs mt-1">Please confirm your new password.</p>
        }
        @if (changePasswordForm.hasError('passwordMismatch') && changePasswordForm.get('confirmNewPassword')?.touched) {
          <p class="text-red-500 text-xs mt-1">Passwords do not match.</p>
        }
      </div>

      <div class="flex justify-end space-x-4 pt-4">
        <button type="button" (click)="goBack()" class="px-4 py-2 rounded font-semibold text-gray-700 bg-gray-200 hover:bg-gray-300 dark:text-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500">Cancel</button>
        <button type="submit" [disabled]="changePasswordForm.invalid" class="px-4 py-2 rounded font-semibold text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400">Update Password</button>
      </div>
    </form>

    @if (statusMessage(); as msg) {
      <div class="mt-4 p-4 rounded-lg border" 
           [class.bg-green-50]="msg.type === 'success'" 
           [class.dark:bg-green-900/50]="msg.type === 'success'" 
           [class.border-green-300]="msg.type === 'success'"
           [class.dark:border-green-700]="msg.type === 'success'"
           [class.text-green-800]="msg.type === 'success'"
           [class.dark:text-green-200]="msg.type === 'success'"
           [class.bg-red-50]="msg.type === 'error'" 
           [class.dark:bg-red-900/50]="msg.type === 'error'" 
           [class.border-red-300]="msg.type === 'error'"
           [class.dark:border-red-700]="msg.type === 'error'"
           [class.text-red-800]="msg.type === 'error'"
           [class.dark:text-red-200]="msg.type === 'error'">
        <p class="font-semibold">{{ msg.text }}</p>
      </div>
    }
  </div>
</div>
